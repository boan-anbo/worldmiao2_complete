(function(e){function t(t){for(var r,c,i=t[0],a=t[1],u=t[2],h=0,b=[];h<i.length;h++)c=i[h],Object.prototype.hasOwnProperty.call(n,c)&&n[c]&&b.push(n[c][0]),n[c]=0;for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r]);l&&l(t);while(b.length)b.shift()();return s.push.apply(s,u||[]),o()}function o(){for(var e,t=0;t<s.length;t++){for(var o=s[t],r=!0,i=1;i<o.length;i++){var a=o[i];0!==n[a]&&(r=!1)}r&&(s.splice(t--,1),e=c(c.s=o[0]))}return e}var r={},n={app:0},s=[];function c(t){if(r[t])return r[t].exports;var o=r[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,c),o.l=!0,o.exports}c.m=e,c.c=r,c.d=function(e,t,o){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(c.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)c.d(o,r,function(t){return e[t]}.bind(null,r));return o},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],a=i.push.bind(i);i.push=t,i=i.slice();for(var u=0;u<i.length;u++)t(i[u]);var l=a;s.push([0,"chunk-vendors"]),o()})({0:function(e,t,o){e.exports=o("cd49")},"0cce":function(e,t,o){},"101b":function(e,t,o){},"311d":function(e,t,o){"use strict";o("101b")},3706:function(e,t,o){"use strict";o("aeff")},"54c2":function(e,t,o){},"6b30":function(e,t){},"7ba0":function(e,t){},"91bd":function(e,t,o){"use strict";o("0cce")},a766:function(e,t,o){},aeff:function(e,t,o){},b7e3:function(e,t,o){"use strict";o("54c2")},cafe:function(e,t,o){},cbe8:function(e,t){},cd49:function(e,t,o){"use strict";o.r(t);o("e260"),o("e6cf"),o("cca6"),o("a79d");var r=o("7a23"),n=Object(r["e"])("div",{class:"bg-gray-700 px-4 truncate text-white text-lg text-center sm:text-right pr-8",style:{"font-family":"'Iceland', sans-serif","background-color":"#5D8D89"}},[Object(r["e"])("span",{class:"sm:inline hidden"}," worldmiao.two | "),Object(r["e"])("span",{class:"text-xs"}," 世界喵兔 "),Object(r["e"])("span",{class:"inline"},"| ebook search engine")],-1),s={id:"main-panel-layout",class:"grid grid-cols-1 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 2xl:grid-cols-6"},c=Object(r["e"])("div",{class:"bg-gray-700 text-white text-lg text-right pr-8",style:{"font-family":"'Iceland', sans-serif","background-color":"#5D8D89"}},[Object(r["e"])("span",null,"(bo an 2020)")],-1);function i(e,t,o,i,a,u){var l=Object(r["l"])("SearchBox"),h=Object(r["l"])("SearchStatusPanel"),b=Object(r["l"])("Library");return Object(r["g"])(),Object(r["c"])(r["a"],null,[n,Object(r["e"])("div",s,[(Object(r["g"])(!0),Object(r["c"])(r["a"],null,Object(r["j"])(e.bookProviderList,(function(o,n){return Object(r["g"])(),Object(r["c"])("div",{key:n},[Object(r["e"])(b,{bookStore:e.bookStore[o.providerEnum],"library-name":o.providerName,colIsEven:n%2===0,"book-provider":o.providerEnum,"library-url":o.url},{"search-box":Object(r["n"])((function(){return[Object(r["e"])(l,{"book-provider":o.providerEnum,onSearchRequest:e.onSearchRequest,searchTerm:e.state.searchTerm,"onUpdate:searchTerm":t[1]||(t[1]=function(t){return e.state.searchTerm=t})},null,8,["book-provider","onSearchRequest","searchTerm"])]})),"search-status":Object(r["n"])((function(t){var n=t.closeBookshelfHandler,s=t.shelfIsEmpty;return[Object(r["e"])(h,{onCloseBookshelf:n,shelfIsEmpty:s,"book-provider":o.providerEnum,bookStore:e.bookStore,searchStore:e.searchStore,onReuseSearchTerm:e.onReuseSearchTerm},null,8,["onCloseBookshelf","shelfIsEmpty","book-provider","bookStore","searchStore","onReuseSearchTerm"])]})),_:2},1032,["bookStore","library-name","colIsEven","book-provider","library-url"])])})),128))]),c],64)}o("99af"),o("d81d");var a,u=o("5530"),l=(o("96cf"),o("1da1")),h=(o("a4d3"),o("e01a"),o("b0c0"),o("9911"),o("d4ec"));(function(e){e["LIBRARY_GENESIS"]="LIBRARY_GENESIS",e["OPEN_LIBRARY"]="OPEN_LIBRARY",e["WORLD_CAT"]="WORLD_CAT",e["GOOGLE_BOOKS"]="GOOGLE_BOOKS",e["MEMORY_OF_THE_WORLD"]="MEMORY_OF_THE_WORLD",e["ZLIBRARY"]="ZLIBRARY"})(a||(a={}));var b,d,f=[{providerName:"Google Books",providerEnum:a.GOOGLE_BOOKS,url:"https://books.google.com/"},{providerName:"Open Library",providerEnum:a.OPEN_LIBRARY,url:"http://openlibrary.org/"},{providerName:"Library Genesis",providerEnum:a.LIBRARY_GENESIS,url:"http://gen.lib.rus.ec/"},{providerName:"Z Library",providerEnum:a.ZLIBRARY,url:"https://z-lib.org/"},{providerName:"Memory of the World",providerEnum:a.MEMORY_OF_THE_WORLD,url:"https://library.memoryoftheworld.org/"},{providerName:"eBook Databases",providerEnum:a.WORLD_CAT,url:""}];(function(e){e["BOOKS"]="BOOKS",e["BOOK_ACCESS"]="BOOK_ACCESS"})(b||(b={})),function(e){e["DOWNLOAD"]="DOWNLOAD",e["BORROW"]="BORROW",e["PURCHASE"]="PURCHASE",e["EBOOK"]="EBOOK",e["DATABASE"]="DATABASE"}(d||(d={}));var p=function e(t,o,r){Object(h["a"])(this,e),this.id="",this.title="",this.pages="",this.subtitle="",this.description="",this.author=" ",this.publicationYear=0,this.isbns=[],this.publisher="",this.format="",this.thumbnail="",this.emptyBook=!1,this.access=[],this.provider=t,null===t&&(this.emptyBook=!0),this.uniqueIdentifier=null!==o&&void 0!==o?o:{id:"",idNote:""},this.title=null!==r&&void 0!==r?r:""},v={style:{"max-width":"100%","max-height":"200px",height:"200px"},class:"search-panel border grid grid-cols-1 content-between"},O={class:"search-header  mt-4 "},m={key:1,class:"white"};function S(e,t,o,n,s,c){var i=Object(r["l"])("VueBook");return Object(r["g"])(),Object(r["c"])(r["a"],null,[Object(r["e"])("div",v,[Object(r["e"])("div",O,[Object(r["e"])("span",{onClick:t[1]||(t[1]=Object(r["p"])((function(e){return c.openLink(o.libraryUrl)}),["stop","prevent"])),class:"text-lg hover:underline text-black cursor-pointer",title:o.libraryUrl,style:{color:"#27302f"}},Object(r["m"])(o.libraryName),9,["title"])]),Object(r["e"])("div",{onClick:t[2]||(t[2]=function(){return c.showBoxes&&c.showBoxes.apply(c,arguments)})},[Object(r["k"])(e.$slots,"search-box")]),Object(r["e"])("div",null,[s.searchStatusShown?Object(r["k"])(e.$slots,"search-status",{key:0,closeBookshelfHandler:c.hideBoxes,shelfIsEmpty:n.shelfIsEmpty()}):Object(r["d"])("",!0),s.searchStatusShown?Object(r["d"])("",!0):(Object(r["g"])(),Object(r["c"])("span",m," "))])]),(Object(r["g"])(!0),Object(r["c"])(r["a"],null,Object(r["j"])(n.bookShelfRef[o.bookProvider],(function(e,t){return Object(r["g"])(),Object(r["c"])("div",{id:"book-shelf",class:"\r\n      bg-gray-200\r\n      bg-opacity-25\r\n      overflow-hidden\r\n      ",key:t},[Object(r["e"])(i,{class:["bookBox",{moveUpOutOfView:!s.boxesShown}],fetchResultRepository:s.fetchResultRepository,bookCoverShown:e.bookCoverShown,book:e.book,"library-name":o.libraryName,index:t,onFetchRequest:c.onReceiveFetchRequest},null,8,["fetchResultRepository","class","bookCoverShown","book","library-name","index","onFetchRequest"])])})),128))],64)}o("c740"),o("4160"),o("fb6a"),o("159b"),o("6b30");var k={style:{"max-width":"100%","min-width":"200px","max-height":"200px",height:"200px","background-color":"#b7d4d2"},class:"overflow-hidden border "},g=Object(r["e"])("div",{class:"cover-header"},null,-1),j={class:"library-name-cover cover-content text-lg"},R=Object(r["e"])("div",{class:"cover-footer"},null,-1),y={class:"font-base"},x={class:"book-info-description grid grid-col-1"},E={class:"text-xs my px-4 truncate my-1  text-gray-600"},w={key:0},I={key:1},T={key:2},B={style:{"max-height":"90px","text-overflow":"ellipsis","word-wrap":"break-word"},class:"description text-left text-xs  py-2 px-6 mx-4 overflow-y-scroll select-none"},C={class:"boot-info-footer pb-2\r\n    text-gray-500\r\n    text-xs"};function A(e,t){var o,n,s,c,i,a,u=this,l=Object(r["l"])("BookAccesses");return Object(r["g"])(),Object(r["c"])("div",k,[Object(r["e"])("div",{style:{"min-height":"200px",height:"200px","background-color":"#5D8D89"},class:[{moveUpOutOfView:!e.bookCoverShown},"bookCover font-bold grid grid-cols-1 content-between"]},[g,Object(r["e"])("div",j,Object(r["m"])(e.libraryName),1),R],2),Object(r["e"])("div",{onClick:t[2]||(t[2]=function(e){return u.toggleBookInfo()}),style:{"min-height":"200px","background-color":"#b7d4d2"},class:[{moveUpOutOfView:!this.state.showInfo,moveIntoViewFromBelow:!e.bookCoverShown},"bookInfo grid grid-cols-1 content-between cursor-pointer"]},[Object(r["e"])("div",{style:{"max-height":"60px","min-height":"60px"},title:e.book.title,class:"\r\n         overflow-truncate\r\n         overflow-y-hidden\r\n\r\n         book-info-title\r\n         text-base\r\n         pl-8  pt-4 pr-6  text-black text-left "},[Object(r["e"])("span",y,Object(r["m"])(e.index+1+"."),1),Object(r["e"])("span",{class:"ml-2 cursor-text",onClick:t[1]||(t[1]=Object(r["p"])((function(){}),["stop"]))},Object(r["m"])(e.book.title),1)],8,["title"]),Object(r["e"])("div",x,[Object(r["e"])("div",E,[null!==(o=e.book)&&void 0!==o&&o.author?(Object(r["g"])(),Object(r["c"])("span",w,Object(r["m"])((null===(n=e.book)||void 0===n?void 0:n.author)+", "),1)):Object(r["d"])("",!0),0!==(null===(s=e.book)||void 0===s?void 0:s.publicationYear)?(Object(r["g"])(),Object(r["c"])("span",I,Object(r["m"])(null===(c=e.book)||void 0===c?void 0:c.publicationYear),1)):Object(r["d"])("",!0),null!==(i=e.book)&&void 0!==i&&i.publisher?(Object(r["g"])(),Object(r["c"])("span",T,Object(r["m"])("; "+(null===(a=e.book)||void 0===a?void 0:a.publisher)),1)):Object(r["d"])("",!0)]),Object(r["e"])("div",B,Object(r["m"])(e.book.description),1)]),Object(r["e"])("div",C,Object(r["m"])(e.libraryName),1)],2),Object(r["e"])("div",{onClick:t[3]||(t[3]=function(t){return e.toggleBookInfo()}),class:[{moveIntoViewFromBelow:!this.state.showInfo&&!e.bookCoverShown},"bookLinks "],style:{"background-color":"#b7d4d2"}},[Object(r["e"])(l,{book:e.book,fetchStatus:this.fetchStatus,accesses:e.accesses,libraryName:e.libraryName,links:e.state.links},null,8,["book","fetchStatus","accesses","libraryName","links"])],2)])}var N;o("a9e3");(function(e){e["IDLE"]="IDLE",e["FETCHING"]="FETCHING",e["QUEUING"]="QUEUING",e["FETCHED"]="FETCHED",e["ERROR"]="ERROR"})(N||(N={}));var L=function(e,t){t.bookAccess=N.FETCHING,console.log("fetching id ",e);var o=setInterval((function(){t.timer++,console.log(t.timer)}),1e3);setTimeout((function(){t.bookAccess=N.FETCHED,clearInterval(o)}),5e3)},_={style:{height:"200px","background-color":"#fffffc !important"},class:"grid  grid-cols-12 content-between cursor-pointer"},q={class:"displaygrid space-y-2 col-span-12 content-between overflow-y-scroll  grid-cols-12"},D={key:0,class:"text-xs col-span-12 cursor-wait "},P={key:1,class:"c text-xs col-span-12 cursor-not-allowed h-full"},F=Object(r["e"])("span",null,"no links found.",-1),H={key:0,class:"truncate"},G={key:1,class:"truncate "},W={id:"access-footer",class:" text-gray-400 col-span-12 pb-2 text-xs"};function Y(e,t){var o;return Object(r["g"])(),Object(r["c"])("div",_,[Object(r["e"])("div",{title:e.book.title,id:"access-header",style:{"max-height":"60px","min-height":"60px"},class:" overflow-y-hidden col-span-12 pt-4 px-4"},[Object(r["e"])("span",{onClick:t[1]||(t[1]=Object(r["p"])((function(){}),["stop"])),class:"cursor-text"},Object(r["m"])(e.book.title),1)],8,["title"]),Object(r["e"])("div",q,["FETCHING"===e.fetchStatus||"QUEUING"===e.fetchStatus?(Object(r["g"])(),Object(r["c"])("div",D,[Object(r["e"])("span",null,Object(r["m"])(e.getStatusString),1)])):Object(r["d"])("",!0),"FETCHED"!==e.fetchStatus&&"ERROR"!==e.fetchStatus||0!==(null===(o=e.accesses)||void 0===o?void 0:o.length)?Object(r["d"])("",!0):(Object(r["g"])(),Object(r["c"])("div",P,[F])),(Object(r["g"])(!0),Object(r["c"])(r["a"],null,Object(r["j"])(e.accesses,(function(t,o){return Object(r["g"])(),Object(r["c"])("div",{key:o,class:"col-span-12 grid grid-cols-12 pl-2 "},[t.type?(Object(r["g"])(),Object(r["c"])("div",{key:0,title:"".concat(t.type,". some might require login"),id:"data-access-type",class:"\r\n              col-span-3\r\n              text-xs\r\n              access-type\r\n              truncate\r\n              text-right\r\n              cursor-pointer\r\n              "},Object(r["m"])(o+1)+": "+Object(r["m"])(e.getAccessTypeString(t.type))+": ",9,["title"])):Object(r["d"])("",!0),Object(r["e"])("div",{title:t.link,class:"text-xs   truncate pl-2 pr-4 col-span-9  text-center"},[t.type!==e.dataType.DATABASE?(Object(r["g"])(),Object(r["c"])("div",H,[Object(r["e"])("span",{onClick:Object(r["p"])((function(o){return e.openWindow(t.link)}),["stop","prevent"]),class:"cursor-pointer hover:underline"},Object(r["m"])(t.link),9,["onClick"])])):Object(r["d"])("",!0),t.type===e.dataType.DATABASE?(Object(r["g"])(),Object(r["c"])("div",G,[Object(r["e"])("span",{onClick:Object(r["p"])((function(o){return e.openWindow(t.link)}),["stop","prevent"]),class:"cursor-pointer hover:underline"},Object(r["m"])(t.name),9,["onClick"])])):Object(r["d"])("",!0)],8,["title"])])})),128))]),Object(r["e"])("div",W,[Object(r["e"])("span",null,Object(r["m"])(e.libraryName),1)])])}var U={name:"BookAccesses",props:{links:Array,book:p,accesses:Array,fetchStatus:N,libraryName:String},methods:{openWindow:function(e){return window.open(e)},getAccessTypeString:function(e){if(e){var t="";switch(e){case d.DATABASE:t="database";break;default:t=e.toLowerCase();break}return t}}},computed:{getStatusString:function(){var e="";switch(this.fetchStatus){case N.FETCHING:e="fetching links ...";break;case N.QUEUING:e="queuing ..";break}return e}},data:function(){return{dataType:d}}};o("3706");U.render=Y;var V=U,M=(o("7ba0"),{name:"VueBook",components:{BookAccesses:V},emits:["fetch-request"],setup:function(e){var t,o=Object(r["h"])({bookAccess:N.IDLE,timer:0,links:null===(t=e.book)||void 0===t?void 0:t.access,showInfo:!0}),n=function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:o.timer=0,o.bookAccess=N.FETCHING,L(t,o);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return{fetch:n,state:o}},props:{book:p,index:Number,bookCoverShown:Boolean,libraryName:String,fetchResultRepository:Object},data:function(){return{accesses:[],fetchStatus:N.IDLE,fetchTimer:0,fetchResultRepositorySub:void 0}},methods:{resetAllProperties:function(){this.fetchStatus.BookAccessFetchingState.IDLE},hasNeedToFetch:function(){return 0===this.accesses.length},onFetchAccess:function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(t,o){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t&&o){e.next=2;break}throw new Error("invalid fetch");case 2:if(this.hasNeedToFetch()){e.next=5;break}return console.log("no need to fetch has ",this.accesses.length),e.abrupt("return");case 5:console.log("need to fetch check",this.hasNeedToFetch()),console.log("Fetch Access"),this.makeFetchRequest(t,o);case 8:case"end":return e.stop()}}),e,this)})));function t(t,o){return e.apply(this,arguments)}return t}(),makeFetchRequest:function(e,t,o){this.fetchStatus=N.QUEUING,this.$emit("fetch-request",{index:e,uniqueId:t,bookId:o})},toggleBookInfo:function(){this.state.showInfo=!this.state.showInfo,this.state.showInfo||this.fetchStatus!==N.IDLE||this.makeFetchRequest(this.index,this.book.uniqueIdentifier.id,this.book.id)}},mounted:function(){var e=this;this.fetchResultRepositorySub=this.fetchResultRepository.subscribe((function(t){var o,r=t.index,n=t.result,s=t.operation,c=t.status;if(r===e.index)switch(s){case"status":e.fetchStatus=c;break;case"result":console.log("Child",e.index,"received repo update",n),e.fetchStatus=N.FETCHED,null!==(o=n.data)&&void 0!==o&&o.data&&(e.accesses=n.data.data);break}}))},unmounted:function(){var e;null===(e=this.fetchResultRepositorySub)||void 0===e||e.unsubscribe()},watch:{book:function(){console.log("FOUND BOOK CHANGED",this.book),this.state.showInfo=!0,this.accesses=this.book.access,this.fetchStatus=N.IDLE}}});o("311d");M.render=A;var K,Q=M,Z=(o("b680"),o("bee2")),$=function e(){Object(h["a"])(this,e),this.bookCoverShown=!0,this.book=new p(null)},J=function(){function e(t){Object(h["a"])(this,e),this.searchedTerm="",this.searchResultCount=null,this._searchingStatus=K.IDLE,this.intervalTimer=0,this.searchTimer=0,this.provider=t}return Object(Z["a"])(e,[{key:"setSearchedTerm",value:function(e){this.searchedTerm=e}},{key:"getSearchedTerm",value:function(){return this.searchedTerm}},{key:"getTimerValue",value:function(){return(this.searchTimer/10).toFixed(1)}},{key:"getCurrentStatus",value:function(){return this._searchingStatus}},{key:"setSearchResultCount",value:function(e){console.log("hit",e),"number"===typeof e&&(this.searchResultCount=e)}},{key:"getSearchResultCount",value:function(){if(void 0!==this.searchResultCount)return this.searchResultCount}},{key:"setSearchStatus",value:function(e){this.searchingStatus=e}},{key:"startTimer",value:function(){var e=this;this.intervalTimer=setInterval((function(){e.searchTimer++}),100)}},{key:"stopTimer",value:function(){clearInterval(this.intervalTimer)}},{key:"resetTimer",value:function(){this.stopTimer(),this.searchTimer=0}},{key:"searchingStatus",set:function(e){switch(e){case K.ERROR:this.stopTimer();break;case K.SEARCHING:this.resetTimer(),this.startTimer();break;case K.SEARCH_FINISHED:this.stopTimer();break}this._searchingStatus=e}}]),e}();(function(e){e["SEARCH_FINISHED"]="done.",e["IDLE"]="ready.",e["SEARCHING"]="searching...",e["ERROR"]="error."})(K||(K={}));var z=o("2bd2"),X=o("3e18"),ee=o("f59d"),te=o("ec26"),oe=o("5670"),re={name:"Library",components:{VueBook:Q},setup:function(e){var t=Object(r["i"])(new Array(20)),o={},n=Object(r["i"])(o),s=function(){console.log("filling empty boxes");for(var e=0;e<f.length;e++){for(var t=[],o=0;o<20;o++)t.push(new $);n.value[f[e].providerEnum]=t}},c=function(e){setTimeout((function(){return a()[e].bookCoverShown=!0}),80*e)},i=function(e){setTimeout((function(){return a()[e].bookCoverShown=!1}),80*e)},a=function(){return n.value[e.bookProvider]},u=function(){n.value[e.bookProvider]=[]},l=function(){var t;return 0===(null===(t=n.value[e.bookProvider])||void 0===t?void 0:t.length)},h=function(e){var t;s();var o=null===(t=e)||void 0===t?void 0:t.length;o>20&&(e=e.slice(0,20)),e.forEach((function(e,t){a()[t].book=e,a()[t].book.id=Object(te["a"])(),console.log("Old Book: ",a()[t].book,"new book",e),i(t)}))},b=function(){for(var t=0;t<n.value[e.bookProvider].length;t++)c(t)},d=function(){for(var t=0;t<n.value[e.bookProvider].length;t++)i(t)};return{books:t,showBookCover:b,hideBookCover:d,bookShelfRef:n,upshelfBooks:h,unshelfBooks:u,getThisShelf:a,fillBookShelfWithEmptyBoxes:s,shelfIsEmpty:l}},props:{libraryName:String,bookProvider:a,colIsEven:Boolean,bookStore:Object,libraryUrl:String},mounted:function(){var e=this;this.fetchRequestQueueSub=this.fetchRequestQueue.pipe(Object(X["a"])(function(){var t=Object(l["a"])(regeneratorRuntime.mark((function t(o){var r,n,s,c,i,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=o.index,n=o.uniqueId,s=o.bookId,console.log("Checking is BookId Is Valid",e.isBookIdValid(s)),e.isBookIdValid(s)){t.next=5;break}return console.log("bookId",s,"no longer existed, drop the request"),t.abrupt("return",null);case 5:return e.updateFetchResultRepoWithStatus({index:r,result:a,status:N.FETCHING}),c="./api/scraper/access",i={uniqueId:n,provider:e.bookProvider},console.log("Sending Request",{index:r,uniqueId:n,payload:i,bookId:s}),t.next=11,e.axios.post(c,i);case 11:return a=t.sent,console.log("inner response received",r,a),t.abrupt("return",{index:r,result:a});case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),Object(ee["a"])((function(e){console.log("fetch failed",e)})),Object(oe["a"])((function(e){return null!==e}))).subscribe((function(t){var o=t.index,r=t.result;"number"===typeof o&&(console.log("outter response received",o,r),console.log("Received loaded for index,",o,r),e.updateFetchResultRepoWithResult({index:o,result:r}))}))},unmounted:function(){var e;null===(e=this.fetchRequestQueueSub)||void 0===e||e.unsubscribe()},data:function(){return{boxesShown:!1,searchStatusShown:!1,fetchRequestQueue:new z["a"],fetchResultRepository:new z["a"],fetchRequestQueueSub:void 0}},methods:{isBookIdValid:function(e){return console.log(this.bookShelfRef[this.bookProvider]),this.bookShelfRef[this.bookProvider].findIndex((function(t){return t.book.id===e}))>-1},updateFetchResultRepoWithResult:function(e){e.operation="result",this.fetchResultRepository.next(e)},updateFetchResultRepoWithStatus:function(e){e.operation="status",this.fetchResultRepository.next(e)},showBoxes:function(){var e=this;this.boxesShown||(setTimeout((function(){return e.boxesShown=!0}),0),setTimeout((function(){return e.searchStatusShown=!0}),.8),this.fillBookShelfWithEmptyBoxes())},hideBoxes:function(){console.log("called"),this.unshelfBooks(),this.boxesShown=!1},openLink:function(e){(null===e||void 0===e?void 0:e.length)<1||window.open(e)},onReceiveFetchRequest:function(e){var t=e.index,o=e.uniqueId,r=e.bookId;console.log("Library put on queue a new fetch request",{index:t,uniqueId:o,bookId:r}),this.fetchRequestQueue.next({index:t,uniqueId:o,bookId:r})}},watch:{bookStore:function(){console.log("Found Book Store Change",this.bookStore),void 0!==this.bookStore&&this.upshelfBooks(this.bookStore.data)}}};o("91bd");re.render=S;var ne=re;function se(e,t){return Object(r["g"])(),Object(r["c"])(r["a"],null,[Object(r["e"])("label",null,[Object(r["e"])("input",{style:{"background-color":"transparent","min-width":"200px"},maxlength:"90",class:"search-input outline-none text-black border-b text-xs",type:"search",value:e.searchTerm,onKeyup:t[1]||(t[1]=Object(r["o"])((function(){return e.makeSearchRequest&&e.makeSearchRequest.apply(e,arguments)}),["enter"])),onInput:t[2]||(t[2]=function(t){return e.emitSearchTermChanges(t.target.value)})},null,40,["value"])]),Object(r["e"])("span",{class:[{"text-gray-200":!e.isRequestValid()},"pl-2 cursor-pointer text-black hover:underline outline-none select-none"],onClick:t[3]||(t[3]=function(){return e.makeSearchRequest&&e.makeSearchRequest.apply(e,arguments)})},"search...",2)],64)}o("498a");var ce=o("c575"),ie=o("6d6a"),ae={name:"SearchBox",emits:["update:searchTerm","searchRequest"],props:{searchTerm:String,hideSearchButton:Boolean,libraryName:String,bookProvider:String},mounted:function(){var e=this;this.requestEmitter.pipe(Object(ie["a"])((function(){return Object(ce["a"])(800)}))).subscribe((function(t){console.log("Emiting a request after interval"),e.$emit("searchRequest",t)}))},unmounted:function(){},methods:{emitSearchTermChanges:function(e){this.localSearchString=e,console.log("Emitting Change"),this.$emit("update:searchTerm",e)},makeSearchRequest:function(){this.isRequestValid()&&this.requestEmitter.next(this.bookProvider)},isRequestValid:function(){var e,t;return(null===(e=this.localSearchString)||void 0===e?void 0:e.trim().length)>2||(null===(t=this.searchTerm)||void 0===t?void 0:t.trim().length)>2},clearInput:function(){this.localSearchString="",this.emitSearchTermChanges("")},inputIsEmpty:function(){return!this.localSearchString&&!this.searchTerm}},data:function(){return{requestEmitter:new z["a"],requestWatcher:null,localSearchString:""}}};o("b7e3");ae.render=se;var ue=ae,le={class:"grid grid-cols-8 space-y-0 text-xs "},he={class:" text-center col-span-8  truncate px-4"},be={key:1,class:"cursor-default"},de={key:0,class:"result-count col-span-2 text-center text-gray-700"},fe={key:1,class:"result-count col-span-2 text-center text-gray-700"},pe={class:"text-center col-span-1 overflow-visible text-gray-700 ",id:"search-timer"},ve=Object(r["e"])("span",null,"[ x ]",-1);function Oe(e,t){return Object(r["g"])(),Object(r["c"])("div",le,[Object(r["e"])("div",he,[e.getSearchTerm.length>0?(Object(r["g"])(),Object(r["c"])("span",{key:0,title:"reuse this search term",onClick:t[1]||(t[1]=function(t){return e.reuseSearchTerm()}),class:"cursor-pointer hover:underline "},Object(r["m"])(e.getSearchTerm),1)):Object(r["d"])("",!0),e.getSearchTerm.length>0?Object(r["d"])("",!0):(Object(r["g"])(),Object(r["c"])("span",be,"   "))]),Object(r["e"])("div",{class:["status col-span-3 text-right text-gray-700",{done:e.searchStore[e.bookProvider].getCurrentStatus()===e.librarySearchStatus.SEARCH_FINISHED}]},"  "+Object(r["m"])(e.searchStore[e.bookProvider].getCurrentStatus()),3),e.searchStore[e.bookProvider].getCurrentStatus()!==e.librarySearchStatus.SEARCH_FINISHED?(Object(r["g"])(),Object(r["c"])("div",de,"   ")):Object(r["d"])("",!0),e.searchStore[e.bookProvider].getCurrentStatus()===e.librarySearchStatus.SEARCH_FINISHED?(Object(r["g"])(),Object(r["c"])("div",fe,Object(r["m"])(e.getSearchResultCount),1)):Object(r["d"])("",!0),Object(r["e"])("div",pe,Object(r["m"])(e.getSearchTime),1),e.shelfIsEmpty?Object(r["d"])("",!0):(Object(r["g"])(),Object(r["c"])("div",{key:2,title:"close results",onClick:t[2]||(t[2]=function(t){return e.closeBookShelf()}),class:"cursor-pointer col-span-2 text-right pr-2 hover:underline"},[ve]))])}o("ac1f"),o("5319"),o("cbe8");var me={name:"SearchStatusPanel",props:["bookStore","searchStore","bookProvider","closeBookshelfHandler","shelfIsEmpty"],emits:["close-bookshelf","reuse-search-term"],setup:function(e){console.log(e);var t=e.searchStore[e.bookProvider].getTimerValue(),o=e.searchStore[e.bookProvider].getCurrentStatus(),r=e.bookProvider+t;return{statusString:r,timer:t,status:o}},data:function(){return{librarySearchStatus:K}},computed:{getSearchTerm:function(){return this.searchStore[this.bookProvider].getSearchedTerm()?'"'.concat(this.searchStore[this.bookProvider].getSearchedTerm(),'"'):""},getSearchTime:function(){return this.searchStore[this.bookProvider].getTimerValue()+"s"},getSearchResultCount:function(){return 0===this.searchStore[this.bookProvider].getSearchResultCount()?"(0 hits.)":"(".concat(this.searchStore[this.bookProvider].getSearchResultCount()," hits.)")}},methods:{closeBookShelf:function(){console.log("emitted"),this.$emit("close-bookshelf",!0)},reuseSearchTerm:function(){var e;this.$emit("reuse-search-term",this.bookProvider,null===(e=this.getSearchTerm)||void 0===e?void 0:e.replace(/"/g,""))}}};me.render=Oe;var Se=me,ke=Object(r["f"])({name:"App",setup:function(){var e=Object(r["h"])({searchTerm:""}),t=f;return{bookProviderList:t,state:e}},data:function(){return{bookProvider:a,libraryOrder:[],searchStore:{GOOGLE_BOOKS:new J(a.GOOGLE_BOOKS),MEMORY_OF_THE_WORLD:new J(a.MEMORY_OF_THE_WORLD),LIBRARY_GENESIS:new J(a.LIBRARY_GENESIS),OPEN_LIBRARY:new J(a.OPEN_LIBRARY),WORLD_CAT:new J(a.WORLD_CAT),ZLIBRARY:new J(a.ZLIBRARY)},bookStore:{GOOGLE_BOOKS:{},MEMORY_OF_THE_WORLD:{},LIBRARY_GENESIS:{},OPEN_LIBRARY:{},WORLD_CAT:{},ZLIBRARY:{}}}},computed:{},methods:{test:function(){console.log("app.vue received close bookshelf")},onSearchRequest:function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(t){var o,r,n,s,c,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t,n=this.state.searchTerm,s="./api/scraper",console.log("Posting your request for ",r,"for term",n," to",s),this.setSearchStatus(r,K.SEARCHING),this.setSearchTerm(r,n),e.next=8,this.axios.post(s,{title:n,provider:r});case 8:c=e.sent,i=c.data,i||this.setSearchStatus(r,K.ERROR),console.log("Received Response From Server for ".concat(r,", for term ").concat(n,", data:"),i),a=i.data.map((function(e){return Object.assign(new p(r),e)})),i.data=a,this.bookStore[r]=Object(u["a"])({},i),this.setSearchStatus(r,K.SEARCH_FINISHED),this.setSearchResultCount(r,null===i||void 0===i||null===(o=i.data)||void 0===o?void 0:o.length);case 17:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),setSearchStatus:function(e,t){this.getSearchStatus(e).setSearchStatus(t)},setSearchTerm:function(e,t){this.getSearchStatus(e).setSearchedTerm(t)},getSearchStatus:function(e){return this.searchStore[e]},setSearchResultCount:function(e,t){this.getSearchStatus(e).setSearchResultCount(t)},onReuseSearchTerm:function(e,t){console.log("On Reuse Search Term",e,t),this.state.searchTerm=t}},components:{Library:ne,SearchBox:ue,SearchStatusPanel:Se}});o("fcda");ke.render=i;var ge=ke,je=o("bc3a"),Re=(o("a766"),o("2106")),ye=o.n(Re);Object(r["b"])(ge).use(ye.a,je).mount("#app"),console.log=function(){}},fcda:function(e,t,o){"use strict";o("cafe")}});
//# sourceMappingURL=app.cc9dfeee.js.map