(function(e){function t(t){for(var o,c,i=t[0],a=t[1],l=t[2],h=0,b=[];h<i.length;h++)c=i[h],Object.prototype.hasOwnProperty.call(n,c)&&n[c]&&b.push(n[c][0]),n[c]=0;for(o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o]);u&&u(t);while(b.length)b.shift()();return s.push.apply(s,l||[]),r()}function r(){for(var e,t=0;t<s.length;t++){for(var r=s[t],o=!0,i=1;i<r.length;i++){var a=r[i];0!==n[a]&&(o=!1)}o&&(s.splice(t--,1),e=c(c.s=r[0]))}return e}var o={},n={app:0},s=[];function c(t){if(o[t])return o[t].exports;var r=o[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,c),r.l=!0,r.exports}c.m=e,c.c=o,c.d=function(e,t,r){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(c.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)c.d(r,o,function(t){return e[t]}.bind(null,o));return r},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],a=i.push.bind(i);i.push=t,i=i.slice();for(var l=0;l<i.length;l++)t(i[l]);var u=a;s.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("cd49")},"0e6b":function(e,t,r){"use strict";r("a911")},1330:function(e,t,r){"use strict";r("dd29")},4429:function(e,t,r){},"4d2b":function(e,t,r){},"6b30":function(e,t){},"7ba0":function(e,t){},"927d":function(e,t,r){"use strict";r("4d2b")},a766:function(e,t,r){},a911:function(e,t,r){},cbe8:function(e,t){},cce8:function(e,t,r){"use strict";r("4429")},cd49:function(e,t,r){"use strict";r.r(t);r("e260"),r("e6cf"),r("cca6"),r("a79d");var o=r("7a23"),n=Object(o["e"])("div",{class:"bg-gray-700 px-4 truncate text-white text-lg text-center sm:text-right pr-8",style:{"font-family":"'Iceland', sans-serif","background-color":"#5D8D89"}},[Object(o["e"])("span",{class:"sm:inline hidden"}," worldmiao.two | "),Object(o["e"])("span",{class:"text-xs"}," 世界喵兔 "),Object(o["e"])("span",{class:"inline"},"| ebook search engine")],-1),s={id:"main-panel-layout",class:"grid grid-cols-1 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 2xl:grid-cols-6"},c=Object(o["e"])("div",{class:"bg-gray-700 text-white text-lg text-right pr-8",style:{"font-family":"'Iceland', sans-serif","background-color":"#5D8D89"}},[Object(o["e"])("span",null,"(bo an 2020)")],-1);function i(e,t,r,i,a,l){var u=Object(o["l"])("SearchBox"),h=Object(o["l"])("SearchStatusPanel"),b=Object(o["l"])("Library");return Object(o["g"])(),Object(o["c"])(o["a"],null,[n,Object(o["e"])("div",s,[(Object(o["g"])(!0),Object(o["c"])(o["a"],null,Object(o["j"])(e.bookProviderList,(function(r,n){return Object(o["g"])(),Object(o["c"])("div",{key:n},[Object(o["e"])(b,{bookStore:e.bookStore[r.providerEnum],"library-name":r.providerName,colIsEven:n%2===0,"book-provider":r.providerEnum,"library-url":r.url,"being-maintained":r.beingMaintained,showAllLibraryBoxes:e.showAllLibraryBoxes},{"search-box":Object(o["o"])((function(){return[Object(o["e"])(u,{class:"static","book-provider":r.providerEnum,onSearchRequest:e.onSearchRequest,"search-all":e.state.searchAll,onOnSearchAll:e.onSearchAll,searchTerm:e.state.searchTerm,"onUpdate:searchTerm":t[1]||(t[1]=function(t){return e.state.searchTerm=t})},null,8,["book-provider","onSearchRequest","search-all","onOnSearchAll","searchTerm"])]})),"search-status":Object(o["o"])((function(t){var n=t.closeBookshelfHandler,s=t.shelfIsEmpty;return[Object(o["e"])(h,{onCloseBookshelf:n,shelfIsEmpty:s,"book-provider":r.providerEnum,bookStore:e.bookStore,searchStore:e.searchStore,onReuseSearchTerm:e.onReuseSearchTerm},null,8,["onCloseBookshelf","shelfIsEmpty","book-provider","bookStore","searchStore","onReuseSearchTerm"])]})),_:2},1032,["bookStore","library-name","colIsEven","book-provider","library-url","being-maintained","showAllLibraryBoxes"])])})),128))]),c],64)}r("99af"),r("d81d");var a,l=r("5530"),u=(r("96cf"),r("1da1")),h=r("668b"),b=(r("a4d3"),r("e01a"),r("b0c0"),r("9911"),r("d4ec"));(function(e){e["LIBRARY_GENESIS"]="LIBRARY_GENESIS",e["OPEN_LIBRARY"]="OPEN_LIBRARY",e["WORLD_CAT"]="WORLD_CAT",e["GOOGLE_BOOKS"]="GOOGLE_BOOKS",e["MEMORY_OF_THE_WORLD"]="MEMORY_OF_THE_WORLD",e["ZLIBRARY"]="ZLIBRARY"})(a||(a={}));var d,f,p=[{providerName:"Google Books",providerEnum:a.GOOGLE_BOOKS,url:"https://books.google.com/",beingMaintained:null},{providerName:"Z Library",providerEnum:a.ZLIBRARY,url:"https://z-lib.org/",beingMaintained:null},{providerName:"Open Library",providerEnum:a.OPEN_LIBRARY,url:"http://openlibrary.org/",beingMaintained:null},{providerName:"Library Genesis",providerEnum:a.LIBRARY_GENESIS,url:"http://gen.lib.rus.ec/",beingMaintained:null},{providerName:"Memory of the World",providerEnum:a.MEMORY_OF_THE_WORLD,url:"https://library.memoryoftheworld.org/",beingMaintained:null},{providerName:"eBook Databases",providerEnum:a.WORLD_CAT,url:"",beingMaintained:"under maintenance. fetch disabled."}];(function(e){e["BOOKS"]="BOOKS",e["BOOK_ACCESS"]="BOOK_ACCESS"})(d||(d={})),function(e){e["DOWNLOAD"]="DOWNLOAD",e["BORROW"]="BORROW",e["PURCHASE"]="PURCHASE",e["EBOOK"]="EBOOK",e["DATABASE"]="DATABASE"}(f||(f={}));var v=function e(t,r,o){Object(b["a"])(this,e),this.id="",this.title="",this.pages="",this.subtitle="",this.description="",this.author=" ",this.publicationYear=0,this.isbns=[],this.publisher="",this.format="",this.thumbnail="",this.emptyBook=!1,this.access=[],this.provider=t,null===t&&(this.emptyBook=!0),this.uniqueIdentifier=null!==r&&void 0!==r?r:{id:"",idNote:""},this.title=null!==o&&void 0!==o?o:""},O={style:{"max-width":"100%","max-height":"200px",height:"200px"},class:"search-panel border grid grid-cols-1 content-between"},g={class:"search-header  mt-4 "},S={class:"hover:underline"},m={key:0,class:"hover:no-underline text-xs text-gray-600"},k=Object(o["e"])("div",{class:"row-3"},null,-1),j={key:0},R={key:1,class:"white"};function y(e,t,r,n,s,c){var i=Object(o["l"])("VueBook");return Object(o["g"])(),Object(o["c"])(o["a"],null,[Object(o["e"])("div",O,[Object(o["e"])("div",g,[Object(o["e"])("span",{onClick:t[1]||(t[1]=Object(o["r"])((function(e){return c.openLink(r.libraryUrl)}),["stop","prevent"])),class:"text-lg  text-black cursor-pointer",title:r.libraryUrl,style:{color:"#27302f"}},[Object(o["e"])("span",S,Object(o["m"])(r.libraryName),1),null!==r.beingMaintained?(Object(o["g"])(),Object(o["c"])("p",m,"("+Object(o["m"])(r.beingMaintained)+")",1)):Object(o["d"])("",!0)],8,["title"])]),k,Object(o["e"])("div",{onClick:t[2]||(t[2]=function(){return c.showBoxes&&c.showBoxes.apply(c,arguments)})},[Object(o["k"])(e.$slots,"search-box")]),s.searchStatusShown?(Object(o["g"])(),Object(o["c"])("div",j,[Object(o["k"])(e.$slots,"search-status",{closeBookshelfHandler:c.hideBoxes,shelfIsEmpty:n.shelfIsEmpty()})])):Object(o["d"])("",!0),s.searchStatusShown?Object(o["d"])("",!0):(Object(o["g"])(),Object(o["c"])("div",R," "))]),(Object(o["g"])(!0),Object(o["c"])(o["a"],null,Object(o["j"])(n.bookShelfRef[r.bookProvider],(function(e,t){return Object(o["g"])(),Object(o["c"])("div",{id:"book-shelf",class:"\r\n      bg-gray-200\r\n      bg-opacity-25\r\n      overflow-hidden\r\n\r\n      ",key:t},[Object(o["e"])(i,{class:["bookBox",{moveUpOutOfView:!s.boxesShown}],fetchResultRepository:s.fetchResultRepository,bookCoverShown:e.bookCoverShown,book:e.book,"library-name":r.libraryName,index:t,beingMaintained:r.beingMaintained,onFetchRequest:c.onReceiveFetchRequest},null,8,["fetchResultRepository","class","bookCoverShown","book","library-name","index","beingMaintained","onFetchRequest"])])})),128))],64)}r("c740"),r("4160"),r("fb6a"),r("159b"),r("6b30");var x={style:{"max-width":"100%","min-width":"200px","max-height":"200px",height:"200px","background-color":"#b7d4d2"},class:"overflow-hidden border "},E=Object(o["e"])("div",{class:"cover-header"},null,-1),w={class:"library-name-cover cover-content text-lg"},I=Object(o["e"])("div",{class:"cover-footer"},null,-1),A={class:"font-base"},T={class:"ml-2 "},B={class:"book-info-description grid grid-col-1"},C={class:"text-xs my px-4 truncate my-1  text-gray-600"},_={key:0},L={key:1},N={key:2},q={style:{"max-height":"90px","text-overflow":"ellipsis","word-wrap":"break-word"},class:"description text-left text-xs  py-2 px-6 mx-4 overflow-y-scroll select-none"},P={class:"boot-info-footer pb-2\r\n    text-gray-500\r\n    text-xs"};function D(e,t){var r,n,s,c,i,a,l=this,u=Object(o["l"])("BookAccesses");return Object(o["g"])(),Object(o["c"])("div",x,[Object(o["e"])("div",{style:{"min-height":"200px",height:"200px","background-color":"#5D8D89"},class:[{moveUpOutOfView:!e.bookCoverShown},"bookCover font-bold grid grid-cols-1 content-between"]},[E,Object(o["e"])("div",w,Object(o["m"])(e.libraryName),1),I],2),Object(o["e"])("div",{onClick:t[1]||(t[1]=function(e){return l.toggleBookInfo()}),style:{"min-height":"200px","background-color":"#b7d4d2"},class:[{moveUpOutOfView:!this.state.showInfo,moveIntoViewFromBelow:!e.bookCoverShown,"cursor-pointer":null===this.beingMaintained,"cursor-not-allowed":null!==this.beingMaintained},"bookInfo grid grid-cols-1 content-between "]},[Object(o["e"])("div",{style:{"max-height":"60px","min-height":"60px"},title:e.book.title,class:"\r\n         overflow-truncate\r\n         overflow-y-hidden\r\n\r\n         book-info-title\r\n         text-base\r\n         pl-8  pt-4 pr-6  text-black text-left "},[Object(o["e"])("span",A,Object(o["m"])(e.index+1+"."),1),Object(o["e"])("span",T,Object(o["m"])(e.book.title),1)],8,["title"]),Object(o["e"])("div",B,[Object(o["e"])("div",C,[null!==(r=e.book)&&void 0!==r&&r.author?(Object(o["g"])(),Object(o["c"])("span",_,Object(o["m"])((null===(n=e.book)||void 0===n?void 0:n.author)+", "),1)):Object(o["d"])("",!0),0!==(null===(s=e.book)||void 0===s?void 0:s.publicationYear)?(Object(o["g"])(),Object(o["c"])("span",L,Object(o["m"])(null===(c=e.book)||void 0===c?void 0:c.publicationYear),1)):Object(o["d"])("",!0),null!==(i=e.book)&&void 0!==i&&i.publisher?(Object(o["g"])(),Object(o["c"])("span",N,Object(o["m"])("; "+(null===(a=e.book)||void 0===a?void 0:a.publisher)),1)):Object(o["d"])("",!0)]),Object(o["e"])("div",q,Object(o["m"])(e.book.description),1)]),Object(o["e"])("div",P,Object(o["m"])(e.libraryName),1)],2),Object(o["e"])("div",{onClick:t[2]||(t[2]=function(t){return e.toggleBookInfo()}),class:[{moveIntoViewFromBelow:!this.state.showInfo&&!e.bookCoverShown},"bookLinks "],style:{"background-color":"#b7d4d2"}},[Object(o["e"])(u,{book:e.book,fetchStatus:this.fetchStatus,accesses:e.accesses,libraryName:e.libraryName,links:e.state.links},null,8,["book","fetchStatus","accesses","libraryName","links"])],2)])}var F;r("a9e3");(function(e){e["IDLE"]="IDLE",e["FETCHING"]="FETCHING",e["QUEUING"]="QUEUING",e["FETCHED"]="FETCHED",e["ERROR"]="ERROR"})(F||(F={}));var H=function(e,t){t.bookAccess=F.FETCHING,console.log("fetching id ",e);var r=setInterval((function(){t.timer++,console.log(t.timer)}),1e3);setTimeout((function(){t.bookAccess=F.FETCHED,clearInterval(r)}),5e3)},M={style:{height:"200px","background-color":"#fffffc !important"},class:"grid  grid-cols-12 content-between cursor-pointer"},G={class:"displaygrid space-y-2 col-span-12 content-between overflow-y-scroll  grid-cols-12"},W={key:0,class:"text-xs col-span-12 cursor-wait "},Y={key:1,class:"c text-xs col-span-12 cursor-not-allowed h-full"},V=Object(o["e"])("span",null,"no links found.",-1),U={key:0,class:"truncate"},K={key:1,class:"truncate "},Q={id:"access-footer",class:" text-gray-400 col-span-12 pb-2 text-xs"};function $(e,t){var r;return Object(o["g"])(),Object(o["c"])("div",M,[Object(o["e"])("div",{title:e.book.title,id:"access-header",style:{"max-height":"60px","min-height":"60px"},class:" overflow-y-hidden col-span-12 pt-4 px-4"},[Object(o["e"])("span",{onClick:t[1]||(t[1]=Object(o["r"])((function(){}),["stop"])),class:"cursor-text"},Object(o["m"])(e.book.title),1)],8,["title"]),Object(o["e"])("div",G,["FETCHING"===e.fetchStatus||"QUEUING"===e.fetchStatus?(Object(o["g"])(),Object(o["c"])("div",W,[Object(o["e"])("span",null,Object(o["m"])(e.getStatusString),1)])):Object(o["d"])("",!0),"FETCHED"!==e.fetchStatus&&"ERROR"!==e.fetchStatus||0!==(null===(r=e.accesses)||void 0===r?void 0:r.length)?Object(o["d"])("",!0):(Object(o["g"])(),Object(o["c"])("div",Y,[V])),(Object(o["g"])(!0),Object(o["c"])(o["a"],null,Object(o["j"])(e.accesses,(function(t,r){return Object(o["g"])(),Object(o["c"])("div",{key:r,class:"col-span-12 grid grid-cols-12 pl-2 "},[t.type?(Object(o["g"])(),Object(o["c"])("div",{key:0,title:"".concat(t.type,". some might require login"),id:"data-access-type",class:"\r\n              col-span-3\r\n              text-xs\r\n              access-type\r\n              truncate\r\n              text-right\r\n              cursor-pointer\r\n              "},Object(o["m"])(r+1)+": "+Object(o["m"])(e.getAccessTypeString(t.type))+": ",9,["title"])):Object(o["d"])("",!0),Object(o["e"])("div",{title:t.link,class:"text-xs   truncate pl-2 pr-4 col-span-9  text-center"},[t.type!==e.dataType.DATABASE?(Object(o["g"])(),Object(o["c"])("div",U,[Object(o["e"])("span",{onClick:Object(o["r"])((function(r){return e.openWindow(t.link)}),["stop","prevent"]),class:"cursor-pointer hover:underline"},Object(o["m"])(t.link),9,["onClick"])])):Object(o["d"])("",!0),t.type===e.dataType.DATABASE?(Object(o["g"])(),Object(o["c"])("div",K,[Object(o["e"])("span",{onClick:Object(o["r"])((function(r){return e.openWindow(t.link)}),["stop","prevent"]),class:"cursor-pointer hover:underline"},Object(o["m"])(t.name),9,["onClick"])])):Object(o["d"])("",!0)],8,["title"])])})),128))]),Object(o["e"])("div",Q,[Object(o["e"])("span",null,Object(o["m"])(e.libraryName),1)])])}var Z={name:"BookAccesses",props:{links:Array,book:v,accesses:Array,fetchStatus:F,libraryName:String},methods:{openWindow:function(e){return window.open(e)},getAccessTypeString:function(e){if(e){var t="";switch(e){case f.DATABASE:t="database";break;default:t=e.toLowerCase();break}return t}}},computed:{getStatusString:function(){var e="";switch(this.fetchStatus){case F.FETCHING:e="fetching links ...";break;case F.QUEUING:e="queuing ..";break}return e}},data:function(){return{dataType:f}}};r("fff8");Z.render=$;var J=Z,z=(r("7ba0"),{name:"VueBook",components:{BookAccesses:J},emits:["fetch-request"],setup:function(e){var t,r=Object(o["h"])({bookAccess:F.IDLE,timer:0,links:null===(t=e.book)||void 0===t?void 0:t.access,showInfo:!0}),n=function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:r.timer=0,r.bookAccess=F.FETCHING,H(t,r);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return{fetch:n,state:r}},props:{book:v,index:Number,bookCoverShown:Boolean,libraryName:String,fetchResultRepository:Object,beingMaintained:String},data:function(){return{accesses:[],fetchStatus:F.IDLE,fetchTimer:0,fetchResultRepositorySub:void 0}},methods:{resetAllProperties:function(){this.fetchStatus.BookAccessFetchingState.IDLE},hasNeedToFetch:function(){return 0===this.accesses.length},onFetchAccess:function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t&&r){e.next=2;break}throw new Error("invalid fetch");case 2:if(this.hasNeedToFetch()){e.next=5;break}return console.log("no need to fetch has ",this.accesses.length),e.abrupt("return");case 5:console.log("need to fetch check",this.hasNeedToFetch()),console.log("Fetch Access"),this.makeFetchRequest(t,r);case 8:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}(),makeFetchRequest:function(e,t,r){this.fetchStatus=F.QUEUING,this.$emit("fetch-request",{index:e,uniqueId:t,bookId:r})},toggleBookInfo:function(){if(console.log("Checking maintainance status",this.beingMaintained),null===this.beingMaintained){if(this.state.showInfo=!this.state.showInfo,!this.state.showInfo&&this.fetchStatus===F.IDLE){if(!this.hasNeedToFetch())return void console.log("no need to fetch has ",this.accesses.length);this.makeFetchRequest(this.index,this.book.uniqueIdentifier.id,this.book.id)}}else console.log(this.beingMaintained)}},mounted:function(){var e=this;this.fetchResultRepositorySub=this.fetchResultRepository.subscribe((function(t){var r,o=t.index,n=t.result,s=t.operation,c=t.status;if(o===e.index)switch(s){case"status":e.fetchStatus=c;break;case"result":console.log("Child",e.index,"received repo update",n),e.fetchStatus=F.FETCHED,null!==n&&void 0!==n&&null!==(r=n.data)&&void 0!==r&&r.data&&(e.accesses=n.data.data);break}}))},unmounted:function(){var e;null===(e=this.fetchResultRepositorySub)||void 0===e||e.unsubscribe()},watch:{book:function(){this.state.showInfo=!0,this.accesses=this.book.access,this.fetchStatus=F.IDLE}}});r("cce8");z.render=D;var X,ee=z,te=(r("b680"),r("bee2")),re=function e(){Object(b["a"])(this,e),this.bookCoverShown=!0,this.book=new v(null)},oe=function(){function e(t){Object(b["a"])(this,e),this.searchedTerm="",this.searchResultCount=null,this._searchingStatus=X.IDLE,this.intervalTimer=0,this.searchTimer=0,this.provider=t}return Object(te["a"])(e,[{key:"setSearchedTerm",value:function(e){this.searchedTerm=e}},{key:"getSearchedTerm",value:function(){return this.searchedTerm}},{key:"getTimerValue",value:function(){return(this.searchTimer/10).toFixed(1)}},{key:"getCurrentStatus",value:function(){return this._searchingStatus}},{key:"setSearchResultCount",value:function(e){console.log("hit",e),"number"===typeof e&&(this.searchResultCount=e)}},{key:"getSearchResultCount",value:function(){if(void 0!==this.searchResultCount)return this.searchResultCount}},{key:"setSearchStatus",value:function(e){this.searchingStatus=e}},{key:"startTimer",value:function(){var e=this;this.intervalTimer=setInterval((function(){e.searchTimer++}),100)}},{key:"stopTimer",value:function(){clearInterval(this.intervalTimer)}},{key:"resetTimer",value:function(){this.stopTimer(),this.searchTimer=0}},{key:"searchingStatus",set:function(e){switch(e){case X.ERROR:this.stopTimer();break;case X.SEARCHING:this.resetTimer(),this.startTimer();break;case X.SEARCH_FINISHED:this.stopTimer();break}this._searchingStatus=e}}]),e}();(function(e){e["SEARCH_FINISHED"]="done.",e["IDLE"]="ready.",e["SEARCHING"]="searching...",e["ERROR"]="error."})(X||(X={}));var ne=r("2bd2"),se=r("3e18"),ce=r("ec26"),ie=r("5670"),ae={name:"Library",components:{VueBook:ee},setup:function(e){var t=Object(o["i"])(new Array(20)),r={},n=Object(o["i"])(r),s=function(){console.log("filling empty boxes");for(var e=0;e<p.length;e++){for(var t=[],r=0;r<20;r++)t.push(new re);n.value[p[e].providerEnum]=t}},c=function(e){setTimeout((function(){return a()[e].bookCoverShown=!0}),80*e)},i=function(e){setTimeout((function(){return a()[e].bookCoverShown=!1}),80*e)},a=function(){return n.value[e.bookProvider]},l=function(){n.value[e.bookProvider]=[]},u=function(){var t;return 0===(null===(t=n.value[e.bookProvider])||void 0===t?void 0:t.length)},h=function(e){var t;s();var r=null===(t=e)||void 0===t?void 0:t.length;r>20&&(e=e.slice(0,20)),e.forEach((function(e,t){a()[t].book=e,a()[t].book.id=Object(ce["a"])(),i(t)}))},b=function(){for(var t=0;t<n.value[e.bookProvider].length;t++)c(t)},d=function(){for(var t=0;t<n.value[e.bookProvider].length;t++)i(t)};return{books:t,showBookCover:b,hideBookCover:d,bookShelfRef:n,upshelfBooks:h,unshelfBooks:l,getThisShelf:a,fillBookShelfWithEmptyBoxes:s,shelfIsEmpty:u}},props:{libraryName:String,bookProvider:a,colIsEven:Boolean,bookStore:Object,libraryUrl:String,beingMaintained:String,showAllLibraryBoxes:Object},mounted:function(){var e,t=this;this.searchAllRequestSub=null===(e=this.showAllLibraryBoxes)||void 0===e?void 0:e.subscribe((function(){console.log("received the cmd to show boxes"),t.showBoxes()})),this.fetchRequestQueueSub=this.fetchRequestQueue.pipe(Object(se["a"])(function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(r){var o,n,s,c,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(o=r.index,n=r.uniqueId,s=r.bookId,console.log("Checking is BookId Is Valid",t.isBookIdValid(s)),t.isBookIdValid(s)){e.next=5;break}return console.log("bookId",s,"no longer existed, drop the request"),e.abrupt("return",null);case 5:return t.updateFetchResultRepoWithStatus({index:o,result:c,status:F.FETCHING}),i="./api/scraper/access",a={uniqueId:n,provider:t.bookProvider},console.log("Sending Request",{index:o,uniqueId:n,payload:a,bookId:s}),e.prev=9,e.next=12,t.axios.post(i,a);case 12:return c=e.sent,console.log("inner response received",o,c),e.abrupt("return",{index:o,result:c});case 17:return e.prev=17,e.t0=e["catch"](9),console.log("catched!"),e.abrupt("return",{index:o,result:null});case 21:case"end":return e.stop()}}),e,null,[[9,17]])})));return function(t){return e.apply(this,arguments)}}()),Object(ie["a"])((function(e){return null!==e}))).subscribe((function(e){if("number"===typeof(null===e||void 0===e?void 0:e.index)){var r=e.index,o=e.result;console.log("outter response received",r,o),console.log("Received loaded for index,",r,o),t.updateFetchResultRepoWithResult({index:r,result:o})}}),(function(){console.log("error")}),(function(){console.log("completed"),t.updateFetchResultRepoWithResult(null)}))},unmounted:function(){var e,t;null===(e=this.fetchRequestQueueSub)||void 0===e||e.unsubscribe(),null===(t=this.searchAllRequestSub)||void 0===t||t.unsubscribe()},data:function(){return{boxesShown:!1,searchStatusShown:!1,fetchRequestQueue:new ne["a"],fetchResultRepository:new ne["a"],fetchRequestQueueSub:void 0,searchAllRequestSub:void 0}},methods:{isBookIdValid:function(e){return console.log(this.bookShelfRef[this.bookProvider]),this.bookShelfRef[this.bookProvider].findIndex((function(t){return t.book.id===e}))>-1},updateFetchResultRepoWithResult:function(e){e.operation="result",this.fetchResultRepository.next(e)},updateFetchResultRepoWithStatus:function(e){e.operation="status",this.fetchResultRepository.next(e)},showBoxes:function(){var e=this;this.boxesShown||(setTimeout((function(){return e.boxesShown=!0}),0),setTimeout((function(){return e.searchStatusShown=!0}),.8),this.fillBookShelfWithEmptyBoxes())},hideBoxes:function(){console.log("called"),this.unshelfBooks(),this.boxesShown=!1},openLink:function(e){(null===e||void 0===e?void 0:e.length)<1||window.open(e)},onReceiveFetchRequest:function(e){var t=e.index,r=e.uniqueId,o=e.bookId;console.log("Library put on queue a new fetch request",{index:t,uniqueId:r,bookId:o}),this.fetchRequestQueue.next({index:t,uniqueId:r,bookId:o})}},watch:{bookStore:function(){console.log("Found Book Store Change",this.bookStore),void 0!==this.bookStore&&this.upshelfBooks(this.bookStore.data)}}};r("927d");ae.render=y;var le=ae,ue={class:"grid grid-cols-1"},he={class:"checkbox-div select-none"},be=Object(o["e"])("div",{style:{width:"205px"},class:" inline-block"}," ",-1),de={class:"inline-block"},fe=Object(o["e"])("div",{class:"inline-block pl-2 text-gray-400 text-base"},"all",-1);function pe(e,t){return Object(o["g"])(),Object(o["c"])("div",ue,[Object(o["e"])("div",null,[Object(o["e"])("label",null,[Object(o["e"])("input",{style:{"background-color":"transparent","min-width":"200px"},maxlength:"90",class:"search-input outline-none text-black border-b text-xs",type:"search",value:e.searchTerm,onKeyup:t[1]||(t[1]=Object(o["q"])((function(){return e.makeSearchRequest&&e.makeSearchRequest.apply(e,arguments)}),["enter"])),onInput:t[2]||(t[2]=function(t){return e.emitSearchTermChanges(t.target.value)})},null,40,["value"]),Object(o["e"])("span",{class:[{"text-gray-200":!e.isRequestValid()},"pl-2 cursor-pointer text-black hover:underline outline-none select-none"],onClick:t[3]||(t[3]=function(){return e.makeSearchRequest&&e.makeSearchRequest.apply(e,arguments)})},"search...",2)])]),Object(o["p"])(Object(o["e"])("div",null," ",512),[[o["n"],!e.isRequestValid()]]),Object(o["p"])(Object(o["e"])("div",he,[be,Object(o["e"])("div",de,[Object(o["e"])("label",null,[Object(o["e"])("input",{type:"checkbox",checked:e.searchAll,onChange:t[4]||(t[4]=function(t){return e.toggleSearchAll(t.target.checked)})},null,40,["checked"]),fe])])],512),[[o["n"],e.isRequestValid()]])])}r("498a");var ve=r("c575"),Oe=r("6d6a"),ge={name:"SearchBox",emits:["update:searchTerm","searchRequest","onSearchAll"],props:{searchTerm:String,hideSearchButton:Boolean,libraryName:String,bookProvider:String,searchAll:Boolean},mounted:function(){var e=this;this.requestEmitter.pipe(Object(Oe["a"])((function(){return Object(ve["a"])(800)}))).subscribe((function(t){console.log("Emiting a request after interval"),e.$emit("searchRequest",t)}))},unmounted:function(){},methods:{emitSearchTermChanges:function(e){this.localSearchString=e,console.log("Emitting Change"),this.$emit("update:searchTerm",e)},makeSearchRequest:function(){this.isRequestValid()&&this.requestEmitter.next(this.bookProvider)},isRequestValid:function(){var e,t;return(null===(e=this.localSearchString)||void 0===e?void 0:e.trim().length)>2||(null===(t=this.searchTerm)||void 0===t?void 0:t.trim().length)>2},clearInput:function(){this.localSearchString="",this.emitSearchTermChanges("")},inputIsEmpty:function(){return!this.localSearchString&&!this.searchTerm},toggleSearchAll:function(e){this.$emit("onSearchAll",e)}},data:function(){return{requestEmitter:new ne["a"],requestWatcher:null,localSearchString:""}}};r("0e6b");ge.render=pe;var Se=ge,me={class:"grid grid-cols-8 text-xs "},ke={class:" text-center col-span-8  truncate px-4"},je={key:1,class:"cursor-default"},Re={key:0,class:"result-count col-span-2 text-center text-gray-700"},ye={key:1,class:"result-count col-span-2 text-center text-gray-700"},xe={class:"text-center col-span-1 overflow-visible text-gray-700 ",id:"search-timer"},Ee=Object(o["e"])("span",{class:"cursor-pointer hover:underline"},"[ x ]",-1);function we(e,t){return Object(o["g"])(),Object(o["c"])("div",me,[Object(o["e"])("div",ke,[e.getSearchTerm.length>0?(Object(o["g"])(),Object(o["c"])("span",{key:0,title:"reuse this search term",onClick:t[1]||(t[1]=function(t){return e.reuseSearchTerm()}),class:"cursor-pointer hover:underline "},Object(o["m"])(e.getSearchTerm),1)):Object(o["d"])("",!0),e.getSearchTerm.length>0?Object(o["d"])("",!0):(Object(o["g"])(),Object(o["c"])("span",je,"   "))]),Object(o["e"])("div",{class:["status col-span-3 text-right text-gray-700",{done:e.searchStore[e.bookProvider].getCurrentStatus()===e.librarySearchStatus.SEARCH_FINISHED}]},"  "+Object(o["m"])(e.searchStore[e.bookProvider].getCurrentStatus()),3),e.searchStore[e.bookProvider].getCurrentStatus()!==e.librarySearchStatus.SEARCH_FINISHED?(Object(o["g"])(),Object(o["c"])("div",Re,"   ")):Object(o["d"])("",!0),e.searchStore[e.bookProvider].getCurrentStatus()===e.librarySearchStatus.SEARCH_FINISHED?(Object(o["g"])(),Object(o["c"])("div",ye,Object(o["m"])(e.getSearchResultCount),1)):Object(o["d"])("",!0),Object(o["e"])("div",xe,Object(o["m"])(e.getSearchTime),1),e.shelfIsEmpty?Object(o["d"])("",!0):(Object(o["g"])(),Object(o["c"])("div",{key:2,title:"close results",onClick:t[2]||(t[2]=function(t){return e.closeBookShelf()}),class:" col-span-2 text-right pr-2 "},[Ee]))])}r("ac1f"),r("5319"),r("cbe8");var Ie={name:"SearchStatusPanel",props:["bookStore","searchStore","bookProvider","closeBookshelfHandler","shelfIsEmpty"],emits:["close-bookshelf","reuse-search-term"],setup:function(e){console.log(e);var t=e.searchStore[e.bookProvider].getTimerValue(),r=e.searchStore[e.bookProvider].getCurrentStatus(),o=e.bookProvider+t;return{statusString:o,timer:t,status:r}},data:function(){return{librarySearchStatus:X}},computed:{getSearchTerm:function(){return this.searchStore[this.bookProvider].getSearchedTerm()?'"'.concat(this.searchStore[this.bookProvider].getSearchedTerm(),'"'):""},getSearchTime:function(){return this.searchStore[this.bookProvider].getTimerValue()+"s"},getSearchResultCount:function(){return 0===this.searchStore[this.bookProvider].getSearchResultCount()?"(0 hits.)":"(".concat(this.searchStore[this.bookProvider].getSearchResultCount()," hits.)")}},methods:{closeBookShelf:function(){console.log("emitted"),this.$emit("close-bookshelf",!0)},reuseSearchTerm:function(){var e;this.$emit("reuse-search-term",this.bookProvider,null===(e=this.getSearchTerm)||void 0===e?void 0:e.replace(/"/g,""))}}};Ie.render=we;var Ae=Ie,Te=Object(o["f"])({name:"App",setup:function(){var e=Object(o["h"])({searchTerm:"",searchAll:!1}),t=p;return{bookProviderList:t,state:e}},data:function(){return{bookProvider:a,libraryOrder:[],searchStore:{GOOGLE_BOOKS:new oe(a.GOOGLE_BOOKS),MEMORY_OF_THE_WORLD:new oe(a.MEMORY_OF_THE_WORLD),LIBRARY_GENESIS:new oe(a.LIBRARY_GENESIS),OPEN_LIBRARY:new oe(a.OPEN_LIBRARY),WORLD_CAT:new oe(a.WORLD_CAT),ZLIBRARY:new oe(a.ZLIBRARY)},bookStore:{GOOGLE_BOOKS:{},MEMORY_OF_THE_WORLD:{},LIBRARY_GENESIS:{},OPEN_LIBRARY:{},WORLD_CAT:{},ZLIBRARY:{}},showAllLibraryBoxes:new ne["a"],currentSearchAllRequestId:""}},computed:{},methods:{test:function(){console.log("app.vue received close bookshelf")},onSearchRequest:function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.state.searchAll?this.searchAll():this.sendSearchRequest(t);case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),searchAll:function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(){var t,r,o,n,s,c,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.showAllLibraryBoxes.next(),t=Object(ce["a"])(),this.currentSearchAllRequestId=t,r=!0,o=!1,e.prev=5,s=Object(h["a"])(this.bookProviderList);case 7:return e.next=9,s.next();case 9:return c=e.sent,r=c.done,e.next=13,c.value;case 13:if(i=e.sent,r){e.next=23;break}if(a=i,this.currentSearchAllRequestId===t){e.next=18;break}return e.abrupt("break",23);case 18:return e.next=20,this.sendSearchRequest(a.providerEnum,t);case 20:r=!0,e.next=7;break;case 23:e.next=29;break;case 25:e.prev=25,e.t0=e["catch"](5),o=!0,n=e.t0;case 29:if(e.prev=29,e.prev=30,r||null==s.return){e.next=34;break}return e.next=34,s.return();case 34:if(e.prev=34,!o){e.next=37;break}throw n;case 37:return e.finish(34);case 38:return e.finish(29);case 39:case"end":return e.stop()}}),e,this,[[5,25,29,39],[30,,34,38]])})));function t(){return e.apply(this,arguments)}return t}(),sendSearchRequest:function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(t,r){var o,n,s,c,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=this.state.searchTerm,s="./api/scraper",console.log("Posting your request for ",t,"for term",n," to",s),this.setSearchStatus(t,X.SEARCHING),this.setSearchTerm(t,n),e.next=7,this.axios.post(s,{title:n,provider:t});case 7:if(c=e.sent,i=c.data,i||this.setSearchStatus(t,X.ERROR),console.log("Received Response From Server for ".concat(t,", for term ").concat(n,", data:"),i),!r||this.currentSearchAllRequestId===r){e.next=14;break}return console.log("batch search request dropped, drop the fetched data"),e.abrupt("return");case 14:return a=i.data.map((function(e){return Object.assign(new v(t),e)})),i.data=a,this.bookStore[t]=Object(l["a"])({},i),this.setSearchStatus(t,X.SEARCH_FINISHED),this.setSearchResultCount(t,null===i||void 0===i||null===(o=i.data)||void 0===o?void 0:o.length),e.abrupt("return");case 20:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}(),setSearchStatus:function(e,t){this.getSearchStatus(e).setSearchStatus(t)},setSearchTerm:function(e,t){this.getSearchStatus(e).setSearchedTerm(t)},getSearchStatus:function(e){return this.searchStore[e]},setSearchResultCount:function(e,t){this.getSearchStatus(e).setSearchResultCount(t)},onReuseSearchTerm:function(e,t){console.log("On Reuse Search Term",e,t),this.state.searchTerm=t},onSearchAll:function(e){console.log("parent received isSearchALl Checked",e),this.state.searchAll=e}},components:{Library:le,SearchBox:Se,SearchStatusPanel:Ae}});r("1330");Te.render=i;var Be=Te,Ce=r("bc3a"),_e=(r("a766"),r("2106")),Le=r.n(_e);Object(o["b"])(Be).use(Le.a,Ce).mount("#app"),console.log("book search api:",Object({NODE_ENV:"production",VUE_APP_CONSOLE_ENABLED:"true",BASE_URL:"/"}).VUE_APP_SEARCH_API),console.log("book fetch api:",Object({NODE_ENV:"production",VUE_APP_CONSOLE_ENABLED:"true",BASE_URL:"/"}).VUE_APP_FETCH_API)},dd29:function(e,t,r){},fe1e:function(e,t,r){},fff8:function(e,t,r){"use strict";r("fe1e")}});
//# sourceMappingURL=app.8474bd9f.js.map